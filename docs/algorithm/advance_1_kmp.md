---
title: KMP
autoGroup-2: è¿›é˜¶
---

# KMP

å¼€å§‹è®²è§£KMPä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå®é™…çš„é¢˜ç›®ï¼š

![img](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_question.drawio-16829351440049.png)

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªï¼Œå‚æ•°ï¼Œå‚æ•°1 ä¸ºåŸå§‹å­—ç¬¦ä¸²ï¼Œå‚æ•°2 ä¸ºå­å­—ç¬¦ä¸²ï¼Œè¯¥å‡½æ•°æ ¹æ®å­å­—ç¬¦ä¸²æ˜¯å¦è¢«åŸå­å­—ç¬¦ä¸²åŒ…å«ï¼Œè‹¥åŒ…å«ï¼Œåˆ™è¿”å›å­å­—ç¬¦ä¸²å†åŸå§‹å­—ç¬¦ä¸²ä¸­å¼€å§‹çš„ä¸‹æ ‡ï¼Œå¦‚å›¾ä¸Šæ‰€ç¤ºï¼Œè¯¥å‡½æ•°è¿”å› **2**ã€‚

å¦‚æœå­å­—ç¬¦ä¸²ä¸åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼Œåˆ™è¿”å› **-1**

## å¤æ‚åº¦åˆ†æğŸ¤”

å¸¸è§„æ€è·¯ä¸‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œéå†æ¯ä¸€ä¸ªä½ç½®ï¼Œç„¶åå¼€å§‹ä¸å­å­—ç¬¦ä¸²å¯¹æ¯”ï¼Œå¦‚æœæˆåŠŸåŒ¹é…ï¼Œåˆ™è¿”å›è¯¥ä½ç½®çš„ä¸‹æ ‡ï¼Œå¦‚æœéå†å®Œï¼Œéƒ½æ²¡æœ‰åŒ¹é…ä¸Šå­å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿”å› -1

> æœ€å·®æƒ…å†µ

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_fuzadu.drawio.png)

å¦‚æœæˆ‘ä»¬çš„æ•°æ®çŠ¶å†µï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¸º "aaaaaa" ï¼Œå­å­—ç¬¦ä¸²ä¸º "aad"ï¼Œåˆ™æˆ‘ä»¬ä½¿ç”¨å¸¸è§„æ€è·¯å»åŒ¹é…å­å­—ç¬¦ä¸²ï¼Œåˆ™åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä½ç½®éƒ½å°†ä¸å­ä¸²è¿›è¡ŒåŒ¹é…3æ¬¡ï¼Œè€Œä¸”æœ€åä¸€æ¬¡ä¸º "a" åŒ¹é… "d"ï¼ŒåŒ¹é…å¤±è´¥ã€‚

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åˆ™æ€»å…±åŒ¹é…äº† 6 * 3 æ¬¡ï¼Œå¦‚æœåŸå§‹å­—ç¬¦ä¸²ä¸º Nï¼Œå­å­—ç¬¦ä¸²é•¿åº¦ä¸º Mï¼Œåˆ™æˆ‘ä»¬åŒ¹é…äº† N*Mï¼Œæ‰€ä»¥ç®—æ³•å¤æ‚åº¦ä¸º: O( N/*M)

## KMP ç®€ä»‹ğŸ‘‡

kmpç®—æ³•æ˜¯ç”±ä¸‰ä½å¤§ç‰›Knuthã€Morriså’ŒPrattæå‡ºçš„ï¼ˆæ‰€ä»¥å«kmpï¼‰ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨å·²ç»åŒ¹é…è¿‡çš„å­—ç¬¦ä¿¡æ¯æ¥é¿å…é‡å¤æ¯”è¾ƒã€‚ğŸ‘

kmpç®—æ³•æ˜¯ä¸€ç§å¾ˆå‰å®³çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å¿«é€Ÿæ‰¾åˆ°ä¸€ä¸ªçŸ­å­—ç¬¦ä¸²çš„ä½ç½®ã€‚ğŸ‘

## ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ KMPğŸ¤”

å­¦ä¹ äº†kmpç®—æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥è§£å†³å¾ˆå¤šå®é™…é—®é¢˜ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²åŒ¹é…ã€æ–‡æœ¬æœç´¢ã€æ•°æ®å‹ç¼©ç­‰ç­‰ã€‚ğŸ‘

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨kmpç®—æ³•å®ç°ä¸€ä¸ªå…³é”®å­—æœç´¢å¼•æ“ï¼Œå¯¹äºç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢å…³é”®å­—è¿›è¡ŒåŒ¹é…ï¼Œå¿«é€Ÿæ‰¾åˆ°ä¸ä¹‹ç›¸å…³çš„å†…å®¹ã€‚ğŸ‘

è¿™æ ·å°±å¯ä»¥æé«˜ç”¨æˆ·çš„æœç´¢ä½“éªŒï¼Œè®©ä»–ä»¬æ›´å®¹æ˜“æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ã€‚ğŸ‘Œ

## æœ‰ä»€ä¹ˆæ”¶è·ğŸ¤©

- ğŸ‘‰æ›´åŠ ç†Ÿç»ƒåœ°å¤„ç†å­—ç¬¦ä¸²ç›¸å…³çš„é—®é¢˜
- ğŸ‘‰æé«˜ç¨‹åºçš„æ•ˆç‡
- ğŸ‘‰è§£å†³å®é™…é—®é¢˜

## KMPçš„ç®—æ³•æµç¨‹

æˆ‘ä»¬ä»¥ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ä½“ä¼šï¼Œkmpç®—æ³•çš„å…·ä½“æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸‹å›¾çš„åŸå§‹å­—ç¬¦ä¸²ï¼Œå­å­—ç¬¦ä¸²ï¼Œnextæ•°ç»„ã€‚

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_ç®—æ³•æµç¨‹.drawio-168294425373116.png)

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ æœ€é•¿ç›¸ç­‰çš„å‰åç¼€çš„æ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ä¸Šå›¾ä¸­çš„nextæ•°ç»„

> æœ€é•¿ç›¸ç­‰å‰åç¼€

å¯¹ä¸€ä¸ªä»»æ„ i ä½ç½®çš„ å­—ç¬¦ï¼Œæœ€é•¿ç›¸ç­‰çš„å‰åç¼€æ˜¯å¤šå°‘ï¼Ÿ

ä»»æ„ i ä½ç½®çš„å­—ç¬¦æœ€é•¿ç›¸ç­‰çš„å‰åç¼€çš„è¦æ±‚ï¼š

- i ä½ç½®å­—ç¬¦ä¹‹å‰å¿…é¡»è¦æœ‰å­—ç¬¦

- æœ€é•¿ç›¸ç­‰å‰åç¼€è¦æ±‚ä¸èƒ½æ˜¯è¯¥å­—ç¬¦ä¸²å‰é¢çš„æ‰€æœ‰å­—ç¬¦ä¸²
- å‰ç¼€å¿…é¡»åŒ…å«ç¬¬ä¸€ä¸ªå­—ç¬¦
- åç¼€å¿…é¡»åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦

çœ‹ä»¥ä¸‹å…·ä½“çš„å­å­—ç¬¦å¯¹åº”çš„nextæ•°ç»„çš„æ•°æ®çš„ç”±æ¥ï¼š

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_prefix.drawio-16834483836601.png)



> ç®—æ³•æµç¨‹

1. ç¬¬ä¸€æ­¥ï¼šä¸æš´åŠ›åŒ¹é…ä¸€æ ·ï¼Œæˆ‘ä»¬é€‰æ‹©åŸå§‹å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ï¼Œä¸å­å­—ç¬¦åŒ¹é…ï¼Œç›´åˆ°èµ°åˆ°ä¸åŒ¹é…çš„ä½ç½®ã€‚

   ![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_process.drawio.png)

2. ç¬¬äºŒæ­¥ï¼šæ ¹æ®æˆ‘ä»¬çš„nextæ•°ç»„è¿›è¡Œå›é€€ï¼Œä»`b`å­—ç¬¦çš„ä½ç½®å¼€å§‹åŒ¹é…

   ![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_process2.drawio.png)

   3. ç¬¬ä¸‰æ­¥ï¼šç»§ç»­åŒ¹é…ï¼Œç›´åˆ°åŸå§‹å­—ç¬¦ä¸²è¶Šç•Œæˆ–è€…å­å­—ç¬¦è¶Šç•Œåœæ­¢

      ![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_process3.drawio.png)

   4. ç¬¬å››æ­¥ï¼šå¦‚ä½•åˆ¤æ–­åŸå§‹å­—ç¬¦ä¸²ä¸å­å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…ï¼Œæ­£ç¡®çš„åŒ¹é…ä½ç½®åœ¨å“ªé‡Œï¼Ÿä¸Šå›¾å¯ä»¥çŸ¥é“ï¼šå½“åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼Œå­å­—ç¬¦ä¸²å¯ä»¥åŒ¹é…ä¸Šæ—¶ï¼Œå­å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªå¯å¯¹æ¯”çš„ä½ç½®ä¸€å®šæ˜¯è¶Šç•Œçš„ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“

      - å½“å­å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªä½ç½®å·²ç»è¶Šç•Œæ—¶ï¼Œç›´æ¥è¿”å›åŸå§‹å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªå¯¹æ¯”ä½ç½®ï¼ˆ9ï¼‰å‡å»å­å­—ç¬¦ä¸‹ä¸€ä¸ªåŒ¹é…çš„ä½ç½®ï¼ˆ6ï¼‰ï¼Œå¾—åˆ°3ï¼Œæ»¡è¶³æˆ‘ä»¬çš„é¢˜ç›®è¦æ±‚
      - å½“åŒ¹é…æµç¨‹èµ°å®Œï¼Œå­å­—ç¬¦ä¸²æ²¡æœ‰è¶Šç•Œï¼Œä½†æ˜¯åŸå§‹å­—ç¬¦ä¸²è¶Šç•Œäº†ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰åŒ¹é…åˆ°å­å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å› -1

> éƒ¨åˆ†ä»£ç è§£è¯»ï¼š

```go
func FindIndex(originalString string, substring string) int {
	if len(substring) > len(originalString) || substring == "" {
		return -1
	}
    // ç”Ÿæˆnextæ•°ç»„ï¼Œç›®å‰å…ˆä¸ç®¡ï¼Œæˆ‘ä»¬çŸ¥é“nextæ•°ç»„çš„å®šä¹‰å³å¯ï¼Œåé¢ä¼šè®²è§£nextæ•°ç»„å¦‚ä½•ç”Ÿæˆ
	next := GetNext(substring)
	
	originalNextCompareIndex  := 0  // åŸå§‹å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªéœ€è¦æ¯”è¾ƒçš„ä½ç½®ï¼Œä»0ä½ç½®å¼€å§‹
	substringNextCompareIndex := 0  // å­å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªéœ€è¦æ¯”è¾ƒçš„ä½ç½®ï¼Œä»0ä½ç½®å¼€å§‹

    // åªè¦ä¸¤è€…çš„çš„å¯¹æ¯”ä½ç½®ï¼Œæœ‰ä¸€ä¸ªè¶Šç•Œäº†ï¼Œåˆ™é€€å‡ºåŒ¹é…
	for originalNextCompareIndex < len(originalString) && substringNextCompareIndex < len(substring) {
        
		if originalString[originalNextCompareIndex] == substring[substringNextCompareIndex] {
            // å¦‚æœå¯¹æ¯”çš„ä½ç½®ï¼Œå­—ç¬¦ä¸²ç›¸ç­‰ï¼Œåˆ™ä¸¤è€…çš„æ¯”è¾ƒä½ç½®éƒ½åŠ 1
			originalNextCompareIndex++
			substringNextCompareIndex++
		} else if next[substringNextCompareIndex] != -1 {
            // å¦‚æœä¸ç›¸ç­‰ï¼Œä¸”å­å­—ç¬¦ä¸²çš„nextæ•°ç»„ä¸­çš„ä¸‹æ ‡å¯å›é€€ï¼Œåˆ™å°†å­å­—ç¬¦ä¸²çš„å¯¹æ¯”ä½ç½®å›é€€è‡³ next æ•°ç»„æŒ‡å‘çš„ä¸‹æ ‡
			substringNextCompareIndex = next[substringNextCompareIndex]
		} else {
            // next æ•°ç»„ä¸èƒ½å›é€€ï¼Œåˆ™ä»£è¡¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸åŸå§‹å­—ç¬¦ä¸²çš„å½“å‰ä½ç½®éƒ½ä¸ç›¸ç­‰
            // æ‰€ä»¥åŸå§‹å­—ç¬¦ä¸²çš„ index + 1ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡åŒ¹é…
			originalNextCompareIndex++
		}
	}
    // å¦‚æœå­å­—ç¬¦ä¸²çš„åŒ¹é…ä½ç½®è¶Šç•Œäº†ï¼Œåˆ™è¿”å› åŸå§‹å­—ç¬¦ä¸²çš„ä¸‹ä¸€ä¸ªåŒ¹é…ä½ç½®å‡å»å­å­—ç¬¦ä¸²çš„ä¸‹ä¸€ä¸ªåŒ¹é…ä½ç½®
	if substringNextCompareIndex == len(substring) {
		return originalNextCompareIndex - substringNextCompareIndex
	}
    // å¦‚æœå­å­—ç¬¦ä¸²æ²¡æœ‰è¶Šç•Œï¼Œè¯æ˜åŸå§‹å­—ç¬¦ä¸²ä¸­ä¸åŒ…å«å­å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥è¿”å› -1
	return -1
}
```

## åŠ é€Ÿçš„æœ¬è´¨

> å­å­—ç¬¦ä¸²ä¸‹ä¸€æ¬¡å¯¹æ¯”ä½ç½®å›é€€

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_next_help.drawio.png)

åœ¨æš´åŠ›åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬åŒ¹é…ä¸ä¸Šæ—¶ï¼Œæˆ‘ä»¬ç›´æ¥å›é€€å¯¹æ¯”ä½ç½®åˆ°ä¸‹æ ‡ 0ï¼Œä½†æ˜¯åœ¨kmpä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ© next æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“5ä½ç½®çš„cä¸åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸‹ä¸€ä¸ªåŒ¹é…ä½ç½®ç›´æ¥å›é€€åˆ° 2 è€Œä¸æ˜¯ 0ï¼Œå› ä¸º 3ï¼Œ4 ä½ç½®çš„ aa å·²ç»é€šè¿‡åŒ¹é…äº†ï¼Œæ­¤æ—¶ 0ï¼Œ1 ä½ç½®ä¸ 3ï¼Œ4ä½ç½®ç›¸ç­‰ï¼Œæ‰€ä»¥0ï¼Œ1ä½ç½®æˆ‘ä»¬ä¸ç”¨åŒ¹é…ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥è·³è¿‡ï¼Œç›´æ¥ä»2ä½ç½®å¼€å§‹ç»§ç»­ä¸åŸå§‹å­—ç¬¦ä¸²åŒ¹é…ã€‚

> å›é€€æ—¶åŸå§‹ä¸²çš„å®é™…åŒ¹é…çš„èµ·å§‹ä½ç½®

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_next_help2.drawio-168338525894014.png)

å½“å­å­—ç¬¦ä¸²å›é€€åˆ° 2 å¼€å§‹åŒ¹é…ï¼Œä½†æ˜¯åŸå§‹å­—ç¬¦ä¸²åŒ¹é…ä½ç½®ä¸å˜æ—¶ï¼Œç›¸å½“äºåŸå§‹å­—ç¬¦ä¸²åŒ¹é…çš„å¼€å¤´ä½ç½®æ¥åˆ°3ä½ç½®ï¼Œç›´æ¥è·³è¿‡äº† 1ï¼Œ 2 çš„ä½ç½®ï¼Œç›¸æ¯”æš´åŠ›åŒ¹é…ä¼šæ›´å¿«ã€‚

ä½†æ˜¯ä¸ºä»€ä¹ˆ 1ï¼Œ2 ä½ç½®å¼€å¤´ä¸å¯èƒ½åŒ¹é…å‡ºå­å­—ç¬¦ä¸²å‘¢ï¼Ÿ

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_jump.drawio.png)

ä¸Šå›¾å‡è®¾ åŸå§‹å­—ç¬¦ä¸²ä¸­å­˜åœ¨ 2 ä½ç½®å¼€å¤´çš„å­—ç¬¦ä¸²ä¸ å­å­—ç¬¦ä¸²å®Œå…¨åŒ¹é…ï¼Œåˆ™æ–¹æ¡†1ä¸­çš„3ä¸ªå­—ç¬¦ï¼Œä¸æ–¹æ¡†2ä¸­çš„3ä¸ªå­—ç¬¦ä¸€å®šç›¸ç­‰ï¼Œå› ä¸ºå‡è®¾2ä½ç½®å¼€å¤´å­˜åœ¨ä¸å­å­—ç¬¦ä¸²ç›¸åŒ¹é…çš„å­—ç¬¦ã€‚

ç”±äºä¹‹å‰æˆ‘ä»¬å·²ç»åŒ¹é…è¿‡åŸå§‹å­—ç¬¦ä¸²ä¸­ 2-4 çš„å­—ç¬¦ï¼Œä¸ å­å­—ç¬¦ä¸²ä¸­ 2-4 çš„å­—ç¬¦ï¼Œè¯¥ä½ç½®3ä¸ªå­—ç¬¦ç›¸ç­‰ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬é€šè¿‡å‡è®¾å¯ä»¥çŸ¥é“å­å­—ç¬¦ä¸²ä¸­ 0-2 ä½ç½®çš„å­—ç¬¦ï¼Œä¸2-4çš„å­—ç¬¦ç›¸ç­‰ï¼Œæ­¤æ—¶æ»¡è¶³å‰åç¼€å­—ç¬¦ä¸²çš„å®šä¹‰ï¼Œå¯ä»¥çŸ¥é“ 5 ä½ç½®çš„æœ€é•¿ç›¸ç­‰å‰åç¼€ä¸º 3ã€‚

ç”±äºæˆ‘ä»¬5ä½ç½®å·²çŸ¥çš„æœ€é•¿å‰åç¼€ä¸º2ï¼Œ ä¸æˆ‘ä»¬çš„é€šè¿‡å‡è®¾å¾—å‡ºçš„ 3 ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥å‡è®¾ä¸æˆç«‹ã€‚

é€šè¿‡ä¸Šè¿°å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º 2 ä½ç½®å¼€å¤´ä¸å¯èƒ½å¯ä»¥åŒ¹é…å‡ºå­å­—ç¬¦ä¸²ï¼Œ1ä½ç½®åŒç†ã€‚



## Nextæ•°ç»„çš„ç”Ÿæˆ



![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next.drawio-168343261441023.png)

**ç¬¬ä¸€æ­¥åˆå§‹åŒ–nextæ•°ç»„ï¼š**ä¸Šå›¾nextæ•°ç»„ä¸­ï¼Œå‰ä¸¤ä¸ªä½ç½®æ˜¯å›ºå®šçš„ï¼Œ0ä½ç½®ä¹‹å‰æ²¡æœ‰å­—ç¬¦ä¸²ï¼Œä¸å­˜åœ¨æœ€é•¿ç›¸ç­‰å‰åç¼€çš„æ¦‚å¿µï¼Œå¡«å…… -1ã€‚1ä½ç½®å‰åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æœ€é•¿ç›¸ç­‰å‰åç¼€è¦æ±‚æœ€é•¿å‰åç¼€ä¸èƒ½ç­‰äºå­—ç¬¦ä¹‹å‰æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¯¥ä½ç½®å¡«å…… 0ã€‚



![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next1.drawio.png)

**ç¬¬äºŒæ­¥å¡«å……nextæ•°ç»„2ä½ç½®ï¼š**

`nI` çš„å«ä¹‰ï¼š`next `æ•°ç»„å½“å‰éœ€è¦å¡«å……çš„ä½ç½®

`cI `æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š

1.  æŒ‡å‘ ä¸` nI-1 `å°è¯•åŒ¹é…çš„å­—ç¬¦ä¸²
2.  åŒ¹é…å¤±è´¥åï¼ŒæŒ‡å‘nextæ•°ç»„ä¸­å¯è·³è½¬çš„ä½ç½®

æ­¥éª¤ï¼š

1.  æ¯”è¾ƒå­å­—ç¬¦ä¸²ä¸­`cI `ä¸ `nI -1 `çš„å­—ç¬¦ï¼Œa ç­‰äº aï¼Œnext å­—ç¬¦ä¸²çš„` nI `ä½ç½®å³ç­‰äº `cI+1`ï¼Œæ‰€ä»¥ `2` ä½ç½®å¡«` cI+1` = `1`
2. `cI++` ä¸”` nI ++`



![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next2.drawio.png)

**ç¬¬ä¸‰æ­¥å¡«å……nextæ•°ç»„ 3 ä½ç½®ï¼š**

æ­¥éª¤ï¼š

1. ` cI `æŒ‡å‘çš„ `a` ä¸ç­‰äº `nI -1` æŒ‡å‘çš„ `b`ï¼Œæ­¤æ—¶`cI `éœ€è¦å›é€€
2. ` cI`æ ¹æ®nextæ•°ç»„å›é€€ `cI=next[cI]`ï¼Œæ‰€ä»¥` cI`å›é€€ä¸º `0`

![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next3.drawio.png)

3. å›é€€åï¼Œç»§ç»­å¯¹æ¯”å­å­—ç¬¦ä¸­çš„`cI`ä¸ `nI -1` çš„å­—ç¬¦ï¼Œæ­¤æ—¶è¿˜æ˜¯ä¸ç›¸ç­‰
4. æ­¤æ—¶ `cI` ä¸º `0`åœ¨ next ä¸­çš„ `0` ä½ç½®æŒ‡å‘ `-1` å·²ç»æ— æ³•å›é€€
5. ä¸å­˜åœ¨ä¸ `nI-1`åŒ¹é…çš„å­—ç¬¦ï¼Œæ‰€ä»¥ï¼Œnextä¸­`nI`çš„ä½ç½®å¡«å†™0
6. å¡«å†™å®Œå½“å‰çš„`nI`åæ‰§è¡Œ`nI++`ï¼Œè¿›è¡Œä¸‹ä¸€æ¬¡è®¡ç®—



![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next4.drawio.png)



**ç¬¬ä¸‰æ­¥å¡«å……nextæ•°ç»„ 4 ä½ç½®ï¼š**

æ­¥éª¤ï¼š

1.  æ¯”è¾ƒå­å­—ç¬¦ä¸²ä¸­`cI `ä¸ `nI -1 `çš„å­—ç¬¦ï¼Œa ç­‰äº aï¼Œnext å­—ç¬¦ä¸²çš„` nI `ä½ç½®å³ç­‰äº `cI+1`ï¼Œæ‰€ä»¥ `2` ä½ç½®å¡«` cI+1` = `1`
2. `cI++` ä¸”` nI ++`



![](D:/ä¸ªäººé¡¹ç›®/github/muxicode.github.io/docs/.vuepress/public/advance_1_kmp.assets/kmp_gen_next5.drawio-168343612809034.png)



**ç¬¬å››æ­¥å¡«å……nextæ•°ç»„ 5 ä½ç½®ï¼š**

æ­¥éª¤ï¼š

1.  æ¯”è¾ƒå­å­—ç¬¦ä¸²ä¸­`cI `ä¸ `nI-1 `çš„å­—ç¬¦ï¼Œa ç­‰äº aï¼Œnext å­—ç¬¦ä¸²çš„` nI `ä½ç½®å³ç­‰äº `cI+1`ï¼Œæ‰€ä»¥ `2` ä½ç½®å¡«` cI+1` = `2`
2. `cI++` ä¸”` nI ++`



> ä»£ç è§£æ

```go
func GetNext(match string) []int {
	if len(match) == 1 {
		return []int{-1}
	}
    // åˆå§‹åŒ– 0ï¼Œ1 ä½ç½®
	next := make([]int, len(match))
	next[0] = -1
	next[1] = 0

   
	nI := 2 // nextæ•°ç»„ä¸‹ä¸€ä¸ªç”Ÿæˆçš„ä½ç½®çš„ä¸‹æ ‡
	cI := 0 // 1. ä¸ nI-1 å¯¹æ¯”çš„ä½ç½®ä¸‹æ ‡ 2. nextå›é€€çš„ä¸‹æ ‡
	for nI < len(match) {
		if match[nI-1] == match[cI] { // å­—ç¬¦ç›¸ç­‰ç›´æ¥å¡«å†™
			next[nI] = cI +1
			nI++
			cI++
		} else if next[cI] != -1 {  // å­—ç¬¦ä¸ç›¸ç­‰æ—¶å›é€€
			cI = next[cI]
		} else {  // æ— æ³•å›é€€æ—¶ï¼Œç›´æ¥èµ‹0ï¼Œä¸”åˆ°ä¸‹ä¸€ä¸ªä½ç½®
			next[nI] = 0
			nI++
		}
	}
	return next
}
```

## å¤æ‚åº¦è¯æ˜

> ç®—æ³•æµç¨‹ä¸­çš„forå¾ªç¯å¤æ‚åº¦åˆ†æ

```go
func FindIndex(originalString string, substring string) int {
    // O(1)
	if len(substring) > len(originalString) || substring == "" {
		return -1
	}
    // ? å…ˆä¸ç®¡
	next := GetNext(substring)

    // O(1)
	originalNextCompareIndex := 0
	substringNextCompareIndex := 0

    // O(N)
	for originalNextCompareIndex < len(originalString) && substringNextCompareIndex < len(substring) {
		if originalString[originalNextCompareIndex] == substring[substringNextCompareIndex] {
			originalNextCompareIndex++
			substringNextCompareIndex++
		} else if next[substringNextCompareIndex] != -1 {
			substringNextCompareIndex = next[substringNextCompareIndex]
		} else {
			originalNextCompareIndex++
		}
	}
    
    // O(1)
	if substringNextCompareIndex == len(substring) {
		return originalNextCompareIndex - substringNextCompareIndex
	}
	return -1
}

/*
for å¾ªç¯è¿›å…¥äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿ
originalNextCompareIndex ä¸Šé™æ˜¯ N
originalNextCompareIndex - substringNextCompareIndex ä¸Šé™æ˜¯ N

for å¾ªç¯ä¸­æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼Œæ¯æ¬¡å¾ªç¯èµ°å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯
	    	originalNextCompareIndex   	ï¼ˆoriginalNextCompareIndex - substringNextCompareIndexï¼‰

åˆ†æ”¯ä¸€             ä¸Šå‡                                          ä¸å˜
åˆ†æ”¯äºŒ             ä¸å˜                                          ä¸Šå‡
åˆ†æ”¯ä¸‰             ä¸Šå‡                                          ä¸Šå‡

æ¯æ¬¡è¿›å…¥å¾ªç¯å¿…å®šè¿›å…¥å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæœ€å·®æƒ…å†µ ä¼šè®¡ç®— 2N æ¬¡ï¼Œè¿›å…¥åˆ†æ”¯ä¸€Næ¬¡ï¼Œè¿›å…¥åˆ†æ”¯äºŒNæ¬¡ï¼Œæ‰€ä»¥è¯¥éƒ¨åˆ†çš„ç®—æ³•å¤æ‚åº¦ä¸ºO(N)
*/

```

> nextæ•°ç»„forå¾ªç¯çš„å¤æ‚åº¦åˆ†æ

```go
func GetNext(match string) []int {
    ...O(1)
    nI := 2
	cI := 0
    O(n?)
	for nI < len(match) {
		if match[nI-1] == match[cI] {
			next[nI] = cI +1
			nI++
			cI++
		} else if next[cI] != -1 {
			cI = next[cI]
		} else {
			next[nI] = 0
			nI++
		}
	}
	...O(1)
}

/*
for å¾ªç¯è¿›å…¥äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿ
nI ä¸Šé™æ˜¯ M
nI - cI ä¸Šé™æ˜¯ M
for å¾ªç¯ä¸­æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼Œæ¯æ¬¡å¾ªç¯èµ°å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯
	    	nI   	ï¼ˆnI-cIï¼‰

åˆ†æ”¯ä¸€      ä¸Šå‡        ä¸å˜
åˆ†æ”¯äºŒ      ä¸å˜        ä¸Šå‡
åˆ†æ”¯ä¸‰      ä¸Šå‡        ä¸Šå‡

æ¯æ¬¡è¿›å…¥å¾ªç¯å¿…å®šè¿›å…¥å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæœ€å·®æƒ…å†µ ä¼šè®¡ç®— 2M æ¬¡ï¼Œè¿›å…¥åˆ†æ”¯ä¸€Næ¬¡ï¼Œè¿›å…¥åˆ†æ”¯äºŒNæ¬¡ï¼Œæ‰€ä»¥è¯¥éƒ¨åˆ†çš„ç®—æ³•å¤æ‚åº¦ä¸ºO(M)
*/
```

> ç®—æ³•æ•´ä½“å¤æ‚åº¦

```
æ±‚nextæ•°ç»„ï¼ŒO(M)
åŒ¹é…è¿‡ç¨‹ï¼ŒO(N)
å…¶ä½™è¿‡ç¨‹ O(1)
æ€»å¤æ‚åº¦ = O(M) + O(N) + O(1) = O(N)
```

## KMPå®Œæ•´ä»£ç 

```go
func FindIndex(originalString string, substring string) int {
	if len(substring) > len(originalString) || substring == "" {
		return -1
	}
	next := GetNext(substring)

	originalNextCompareIndex := 0
	substringNextCompareIndex := 0

	for originalNextCompareIndex < len(originalString) && substringNextCompareIndex < len(substring) {
		if originalString[originalNextCompareIndex] == substring[substringNextCompareIndex] {
			originalNextCompareIndex++
			substringNextCompareIndex++
		} else if next[substringNextCompareIndex] != -1 {
			substringNextCompareIndex = next[substringNextCompareIndex]
		} else {
			originalNextCompareIndex++
		}
	}
	if substringNextCompareIndex == len(substring) {
		return originalNextCompareIndex - substringNextCompareIndex
	}
	return -1
}

func GetNext(match string) []int {
	if len(match) == 1 {
		return []int{-1}
	}
	next := make([]int, len(match))
	next[0] = -1
	next[1] = 0

	nI := 2
	cI := 0
	for nI < len(match) {
		if match[nI-1] == match[cI] {
			next[nI] = cI +1
			nI++
			cI++
		} else if next[cI] != -1 {
			cI = next[cI]
		} else {
			next[nI] = 0
			nI++
		}
	}
	return next
}
```



